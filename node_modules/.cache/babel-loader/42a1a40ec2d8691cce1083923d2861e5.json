{"ast":null,"code":"import { __awaiter, __generator } from \"tslib\";\nimport { PDFName, PDFArray, PDFDict, PDFHexString } from \"../core\";\n/**\n * Represents a file that has been embedded in a [[PDFDocument]].\n */\nvar PDFEmbeddedFile = /** @class */function () {\n  function PDFEmbeddedFile(ref, doc, embedder) {\n    this.alreadyEmbedded = false;\n    this.ref = ref;\n    this.doc = doc;\n    this.embedder = embedder;\n  }\n  /**\n   * > **NOTE:** You probably don't need to call this method directly. The\n   * > [[PDFDocument.save]] and [[PDFDocument.saveAsBase64]] methods will\n   * > automatically ensure all embeddable files get embedded.\n   *\n   * Embed this embeddable file in its document.\n   *\n   * @returns Resolves when the embedding is complete.\n   */\n  PDFEmbeddedFile.prototype.embed = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var ref, Names, EmbeddedFiles, EFNames, AF;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (!!this.alreadyEmbedded) return [3 /*break*/, 2];\n            return [4 /*yield*/, this.embedder.embedIntoContext(this.doc.context, this.ref)];\n          case 1:\n            ref = _a.sent();\n            if (!this.doc.catalog.has(PDFName.of('Names'))) {\n              this.doc.catalog.set(PDFName.of('Names'), this.doc.context.obj({}));\n            }\n            Names = this.doc.catalog.lookup(PDFName.of('Names'), PDFDict);\n            if (!Names.has(PDFName.of('EmbeddedFiles'))) {\n              Names.set(PDFName.of('EmbeddedFiles'), this.doc.context.obj({}));\n            }\n            EmbeddedFiles = Names.lookup(PDFName.of('EmbeddedFiles'), PDFDict);\n            if (!EmbeddedFiles.has(PDFName.of('Names'))) {\n              EmbeddedFiles.set(PDFName.of('Names'), this.doc.context.obj([]));\n            }\n            EFNames = EmbeddedFiles.lookup(PDFName.of('Names'), PDFArray);\n            EFNames.push(PDFHexString.fromText(this.embedder.fileName));\n            EFNames.push(ref);\n            /**\n             * The AF-Tag is needed to achieve PDF-A3 compliance for embedded files\n             *\n             * The following document outlines the uses cases of the associated files (AF) tag.\n             * See:\n             * https://www.pdfa.org/wp-content/uploads/2018/10/PDF20_AN002-AF.pdf\n             */\n            if (!this.doc.catalog.has(PDFName.of('AF'))) {\n              this.doc.catalog.set(PDFName.of('AF'), this.doc.context.obj([]));\n            }\n            AF = this.doc.catalog.lookup(PDFName.of('AF'), PDFArray);\n            AF.push(ref);\n            this.alreadyEmbedded = true;\n            _a.label = 2;\n          case 2:\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n  /**\n   * > **NOTE:** You probably don't want to call this method directly. Instead,\n   * > consider using the [[PDFDocument.attach]] method, which will create\n   * instances of [[PDFEmbeddedFile]] for you.\n   *\n   * Create an instance of [[PDFEmbeddedFile]] from an existing ref and embedder\n   *\n   * @param ref The unique reference for this file.\n   * @param doc The document to which the file will belong.\n   * @param embedder The embedder that will be used to embed the file.\n   */\n  PDFEmbeddedFile.of = function (ref, doc, embedder) {\n    return new PDFEmbeddedFile(ref, doc, embedder);\n  };\n  return PDFEmbeddedFile;\n}();\nexport default PDFEmbeddedFile;","map":{"version":3,"sources":["../../src/api/PDFEmbeddedFile.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { __awaiter, __generator } from \"tslib\";\nimport { PDFName, PDFArray, PDFDict, PDFHexString } from \"../core\";\n/**\n * Represents a file that has been embedded in a [[PDFDocument]].\n */\nvar PDFEmbeddedFile = /** @class */ (function () {\n    function PDFEmbeddedFile(ref, doc, embedder) {\n        this.alreadyEmbedded = false;\n        this.ref = ref;\n        this.doc = doc;\n        this.embedder = embedder;\n    }\n    /**\n     * > **NOTE:** You probably don't need to call this method directly. The\n     * > [[PDFDocument.save]] and [[PDFDocument.saveAsBase64]] methods will\n     * > automatically ensure all embeddable files get embedded.\n     *\n     * Embed this embeddable file in its document.\n     *\n     * @returns Resolves when the embedding is complete.\n     */\n    PDFEmbeddedFile.prototype.embed = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var ref, Names, EmbeddedFiles, EFNames, AF;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!!this.alreadyEmbedded) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this.embedder.embedIntoContext(this.doc.context, this.ref)];\n                    case 1:\n                        ref = _a.sent();\n                        if (!this.doc.catalog.has(PDFName.of('Names'))) {\n                            this.doc.catalog.set(PDFName.of('Names'), this.doc.context.obj({}));\n                        }\n                        Names = this.doc.catalog.lookup(PDFName.of('Names'), PDFDict);\n                        if (!Names.has(PDFName.of('EmbeddedFiles'))) {\n                            Names.set(PDFName.of('EmbeddedFiles'), this.doc.context.obj({}));\n                        }\n                        EmbeddedFiles = Names.lookup(PDFName.of('EmbeddedFiles'), PDFDict);\n                        if (!EmbeddedFiles.has(PDFName.of('Names'))) {\n                            EmbeddedFiles.set(PDFName.of('Names'), this.doc.context.obj([]));\n                        }\n                        EFNames = EmbeddedFiles.lookup(PDFName.of('Names'), PDFArray);\n                        EFNames.push(PDFHexString.fromText(this.embedder.fileName));\n                        EFNames.push(ref);\n                        /**\n                         * The AF-Tag is needed to achieve PDF-A3 compliance for embedded files\n                         *\n                         * The following document outlines the uses cases of the associated files (AF) tag.\n                         * See:\n                         * https://www.pdfa.org/wp-content/uploads/2018/10/PDF20_AN002-AF.pdf\n                         */\n                        if (!this.doc.catalog.has(PDFName.of('AF'))) {\n                            this.doc.catalog.set(PDFName.of('AF'), this.doc.context.obj([]));\n                        }\n                        AF = this.doc.catalog.lookup(PDFName.of('AF'), PDFArray);\n                        AF.push(ref);\n                        this.alreadyEmbedded = true;\n                        _a.label = 2;\n                    case 2: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /**\n     * > **NOTE:** You probably don't want to call this method directly. Instead,\n     * > consider using the [[PDFDocument.attach]] method, which will create\n     * instances of [[PDFEmbeddedFile]] for you.\n     *\n     * Create an instance of [[PDFEmbeddedFile]] from an existing ref and embedder\n     *\n     * @param ref The unique reference for this file.\n     * @param doc The document to which the file will belong.\n     * @param embedder The embedder that will be used to embed the file.\n     */\n    PDFEmbeddedFile.of = function (ref, doc, embedder) {\n        return new PDFEmbeddedFile(ref, doc, embedder);\n    };\n    return PDFEmbeddedFile;\n}());\nexport default PDFEmbeddedFile;\n//# sourceMappingURL=PDFEmbeddedFile.js.map"]},"metadata":{},"sourceType":"module"}