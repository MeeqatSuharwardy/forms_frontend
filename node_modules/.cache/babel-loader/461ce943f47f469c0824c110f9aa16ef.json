{"ast":null,"code":"import { __assign } from \"tslib\";\nimport pako from 'pako';\nimport PDFHeader from \"./document/PDFHeader\";\nimport { UnexpectedObjectTypeError } from \"./errors\";\nimport PDFArray from \"./objects/PDFArray\";\nimport PDFBool from \"./objects/PDFBool\";\nimport PDFDict from \"./objects/PDFDict\";\nimport PDFName from \"./objects/PDFName\";\nimport PDFNull from \"./objects/PDFNull\";\nimport PDFNumber from \"./objects/PDFNumber\";\nimport PDFObject from \"./objects/PDFObject\";\nimport PDFRawStream from \"./objects/PDFRawStream\";\nimport PDFRef from \"./objects/PDFRef\";\nimport PDFOperator from \"./operators/PDFOperator\";\nimport Ops from \"./operators/PDFOperatorNames\";\nimport PDFContentStream from \"./structures/PDFContentStream\";\nimport { typedArrayFor } from \"../utils\";\nimport { SimpleRNG } from \"../utils/rng\";\nvar byAscendingObjectNumber = function (_a, _b) {\n  var a = _a[0];\n  var b = _b[0];\n  return a.objectNumber - b.objectNumber;\n};\nvar PDFContext = /** @class */function () {\n  function PDFContext() {\n    this.largestObjectNumber = 0;\n    this.header = PDFHeader.forVersion(1, 7);\n    this.trailerInfo = {};\n    this.indirectObjects = new Map();\n    this.rng = SimpleRNG.withSeed(1);\n  }\n  PDFContext.prototype.assign = function (ref, object) {\n    this.indirectObjects.set(ref, object);\n    if (ref.objectNumber > this.largestObjectNumber) {\n      this.largestObjectNumber = ref.objectNumber;\n    }\n  };\n  PDFContext.prototype.nextRef = function () {\n    this.largestObjectNumber += 1;\n    return PDFRef.of(this.largestObjectNumber);\n  };\n  PDFContext.prototype.register = function (object) {\n    var ref = this.nextRef();\n    this.assign(ref, object);\n    return ref;\n  };\n  PDFContext.prototype.delete = function (ref) {\n    return this.indirectObjects.delete(ref);\n  };\n  PDFContext.prototype.lookupMaybe = function (ref) {\n    var types = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n      types[_i - 1] = arguments[_i];\n    }\n    // TODO: `preservePDFNull` is for backwards compatibility. Should be\n    // removed in next breaking API change.\n    var preservePDFNull = types.includes(PDFNull);\n    var result = ref instanceof PDFRef ? this.indirectObjects.get(ref) : ref;\n    if (!result || result === PDFNull && !preservePDFNull) return undefined;\n    for (var idx = 0, len = types.length; idx < len; idx++) {\n      var type = types[idx];\n      if (type === PDFNull) {\n        if (result === PDFNull) return result;\n      } else {\n        if (result instanceof type) return result;\n      }\n    }\n    throw new UnexpectedObjectTypeError(types, result);\n  };\n  PDFContext.prototype.lookup = function (ref) {\n    var types = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n      types[_i - 1] = arguments[_i];\n    }\n    var result = ref instanceof PDFRef ? this.indirectObjects.get(ref) : ref;\n    if (types.length === 0) return result;\n    for (var idx = 0, len = types.length; idx < len; idx++) {\n      var type = types[idx];\n      if (type === PDFNull) {\n        if (result === PDFNull) return result;\n      } else {\n        if (result instanceof type) return result;\n      }\n    }\n    throw new UnexpectedObjectTypeError(types, result);\n  };\n  PDFContext.prototype.getObjectRef = function (pdfObject) {\n    var entries = Array.from(this.indirectObjects.entries());\n    for (var idx = 0, len = entries.length; idx < len; idx++) {\n      var _a = entries[idx],\n        ref = _a[0],\n        object = _a[1];\n      if (object === pdfObject) {\n        return ref;\n      }\n    }\n    return undefined;\n  };\n  PDFContext.prototype.enumerateIndirectObjects = function () {\n    return Array.from(this.indirectObjects.entries()).sort(byAscendingObjectNumber);\n  };\n  PDFContext.prototype.obj = function (literal) {\n    if (literal instanceof PDFObject) {\n      return literal;\n    } else if (literal === null || literal === undefined) {\n      return PDFNull;\n    } else if (typeof literal === 'string') {\n      return PDFName.of(literal);\n    } else if (typeof literal === 'number') {\n      return PDFNumber.of(literal);\n    } else if (typeof literal === 'boolean') {\n      return literal ? PDFBool.True : PDFBool.False;\n    } else if (Array.isArray(literal)) {\n      var array = PDFArray.withContext(this);\n      for (var idx = 0, len = literal.length; idx < len; idx++) {\n        array.push(this.obj(literal[idx]));\n      }\n      return array;\n    } else {\n      var dict = PDFDict.withContext(this);\n      var keys = Object.keys(literal);\n      for (var idx = 0, len = keys.length; idx < len; idx++) {\n        var key = keys[idx];\n        var value = literal[key];\n        if (value !== undefined) dict.set(PDFName.of(key), this.obj(value));\n      }\n      return dict;\n    }\n  };\n  PDFContext.prototype.stream = function (contents, dict) {\n    if (dict === void 0) {\n      dict = {};\n    }\n    return PDFRawStream.of(this.obj(dict), typedArrayFor(contents));\n  };\n  PDFContext.prototype.flateStream = function (contents, dict) {\n    if (dict === void 0) {\n      dict = {};\n    }\n    return this.stream(pako.deflate(typedArrayFor(contents)), __assign(__assign({}, dict), {\n      Filter: 'FlateDecode'\n    }));\n  };\n  PDFContext.prototype.contentStream = function (operators, dict) {\n    if (dict === void 0) {\n      dict = {};\n    }\n    return PDFContentStream.of(this.obj(dict), operators);\n  };\n  PDFContext.prototype.formXObject = function (operators, dict) {\n    if (dict === void 0) {\n      dict = {};\n    }\n    return this.contentStream(operators, __assign(__assign({\n      BBox: this.obj([0, 0, 0, 0]),\n      Matrix: this.obj([1, 0, 0, 1, 0, 0])\n    }, dict), {\n      Type: 'XObject',\n      Subtype: 'Form'\n    }));\n  };\n  /*\n   * Reference to PDFContentStream that contains a single PDFOperator: `q`.\n   * Used by [[PDFPageLeaf]] instances to ensure that when content streams are\n   * added to a modified PDF, they start in the default, unchanged graphics\n   * state.\n   */\n  PDFContext.prototype.getPushGraphicsStateContentStream = function () {\n    if (this.pushGraphicsStateContentStreamRef) {\n      return this.pushGraphicsStateContentStreamRef;\n    }\n    var dict = this.obj({});\n    var op = PDFOperator.of(Ops.PushGraphicsState);\n    var stream = PDFContentStream.of(dict, [op]);\n    this.pushGraphicsStateContentStreamRef = this.register(stream);\n    return this.pushGraphicsStateContentStreamRef;\n  };\n  /*\n   * Reference to PDFContentStream that contains a single PDFOperator: `Q`.\n   * Used by [[PDFPageLeaf]] instances to ensure that when content streams are\n   * added to a modified PDF, they start in the default, unchanged graphics\n   * state.\n   */\n  PDFContext.prototype.getPopGraphicsStateContentStream = function () {\n    if (this.popGraphicsStateContentStreamRef) {\n      return this.popGraphicsStateContentStreamRef;\n    }\n    var dict = this.obj({});\n    var op = PDFOperator.of(Ops.PopGraphicsState);\n    var stream = PDFContentStream.of(dict, [op]);\n    this.popGraphicsStateContentStreamRef = this.register(stream);\n    return this.popGraphicsStateContentStreamRef;\n  };\n  PDFContext.prototype.addRandomSuffix = function (prefix, suffixLength) {\n    if (suffixLength === void 0) {\n      suffixLength = 4;\n    }\n    return prefix + \"-\" + Math.floor(this.rng.nextInt() * Math.pow(10, suffixLength));\n  };\n  PDFContext.create = function () {\n    return new PDFContext();\n  };\n  return PDFContext;\n}();\nexport default PDFContext;","map":{"version":3,"sources":["../../src/core/PDFContext.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { __assign } from \"tslib\";\nimport pako from 'pako';\nimport PDFHeader from \"./document/PDFHeader\";\nimport { UnexpectedObjectTypeError } from \"./errors\";\nimport PDFArray from \"./objects/PDFArray\";\nimport PDFBool from \"./objects/PDFBool\";\nimport PDFDict from \"./objects/PDFDict\";\nimport PDFName from \"./objects/PDFName\";\nimport PDFNull from \"./objects/PDFNull\";\nimport PDFNumber from \"./objects/PDFNumber\";\nimport PDFObject from \"./objects/PDFObject\";\nimport PDFRawStream from \"./objects/PDFRawStream\";\nimport PDFRef from \"./objects/PDFRef\";\nimport PDFOperator from \"./operators/PDFOperator\";\nimport Ops from \"./operators/PDFOperatorNames\";\nimport PDFContentStream from \"./structures/PDFContentStream\";\nimport { typedArrayFor } from \"../utils\";\nimport { SimpleRNG } from \"../utils/rng\";\nvar byAscendingObjectNumber = function (_a, _b) {\n    var a = _a[0];\n    var b = _b[0];\n    return a.objectNumber - b.objectNumber;\n};\nvar PDFContext = /** @class */ (function () {\n    function PDFContext() {\n        this.largestObjectNumber = 0;\n        this.header = PDFHeader.forVersion(1, 7);\n        this.trailerInfo = {};\n        this.indirectObjects = new Map();\n        this.rng = SimpleRNG.withSeed(1);\n    }\n    PDFContext.prototype.assign = function (ref, object) {\n        this.indirectObjects.set(ref, object);\n        if (ref.objectNumber > this.largestObjectNumber) {\n            this.largestObjectNumber = ref.objectNumber;\n        }\n    };\n    PDFContext.prototype.nextRef = function () {\n        this.largestObjectNumber += 1;\n        return PDFRef.of(this.largestObjectNumber);\n    };\n    PDFContext.prototype.register = function (object) {\n        var ref = this.nextRef();\n        this.assign(ref, object);\n        return ref;\n    };\n    PDFContext.prototype.delete = function (ref) {\n        return this.indirectObjects.delete(ref);\n    };\n    PDFContext.prototype.lookupMaybe = function (ref) {\n        var types = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            types[_i - 1] = arguments[_i];\n        }\n        // TODO: `preservePDFNull` is for backwards compatibility. Should be\n        // removed in next breaking API change.\n        var preservePDFNull = types.includes(PDFNull);\n        var result = ref instanceof PDFRef ? this.indirectObjects.get(ref) : ref;\n        if (!result || (result === PDFNull && !preservePDFNull))\n            return undefined;\n        for (var idx = 0, len = types.length; idx < len; idx++) {\n            var type = types[idx];\n            if (type === PDFNull) {\n                if (result === PDFNull)\n                    return result;\n            }\n            else {\n                if (result instanceof type)\n                    return result;\n            }\n        }\n        throw new UnexpectedObjectTypeError(types, result);\n    };\n    PDFContext.prototype.lookup = function (ref) {\n        var types = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            types[_i - 1] = arguments[_i];\n        }\n        var result = ref instanceof PDFRef ? this.indirectObjects.get(ref) : ref;\n        if (types.length === 0)\n            return result;\n        for (var idx = 0, len = types.length; idx < len; idx++) {\n            var type = types[idx];\n            if (type === PDFNull) {\n                if (result === PDFNull)\n                    return result;\n            }\n            else {\n                if (result instanceof type)\n                    return result;\n            }\n        }\n        throw new UnexpectedObjectTypeError(types, result);\n    };\n    PDFContext.prototype.getObjectRef = function (pdfObject) {\n        var entries = Array.from(this.indirectObjects.entries());\n        for (var idx = 0, len = entries.length; idx < len; idx++) {\n            var _a = entries[idx], ref = _a[0], object = _a[1];\n            if (object === pdfObject) {\n                return ref;\n            }\n        }\n        return undefined;\n    };\n    PDFContext.prototype.enumerateIndirectObjects = function () {\n        return Array.from(this.indirectObjects.entries()).sort(byAscendingObjectNumber);\n    };\n    PDFContext.prototype.obj = function (literal) {\n        if (literal instanceof PDFObject) {\n            return literal;\n        }\n        else if (literal === null || literal === undefined) {\n            return PDFNull;\n        }\n        else if (typeof literal === 'string') {\n            return PDFName.of(literal);\n        }\n        else if (typeof literal === 'number') {\n            return PDFNumber.of(literal);\n        }\n        else if (typeof literal === 'boolean') {\n            return literal ? PDFBool.True : PDFBool.False;\n        }\n        else if (Array.isArray(literal)) {\n            var array = PDFArray.withContext(this);\n            for (var idx = 0, len = literal.length; idx < len; idx++) {\n                array.push(this.obj(literal[idx]));\n            }\n            return array;\n        }\n        else {\n            var dict = PDFDict.withContext(this);\n            var keys = Object.keys(literal);\n            for (var idx = 0, len = keys.length; idx < len; idx++) {\n                var key = keys[idx];\n                var value = literal[key];\n                if (value !== undefined)\n                    dict.set(PDFName.of(key), this.obj(value));\n            }\n            return dict;\n        }\n    };\n    PDFContext.prototype.stream = function (contents, dict) {\n        if (dict === void 0) { dict = {}; }\n        return PDFRawStream.of(this.obj(dict), typedArrayFor(contents));\n    };\n    PDFContext.prototype.flateStream = function (contents, dict) {\n        if (dict === void 0) { dict = {}; }\n        return this.stream(pako.deflate(typedArrayFor(contents)), __assign(__assign({}, dict), { Filter: 'FlateDecode' }));\n    };\n    PDFContext.prototype.contentStream = function (operators, dict) {\n        if (dict === void 0) { dict = {}; }\n        return PDFContentStream.of(this.obj(dict), operators);\n    };\n    PDFContext.prototype.formXObject = function (operators, dict) {\n        if (dict === void 0) { dict = {}; }\n        return this.contentStream(operators, __assign(__assign({ BBox: this.obj([0, 0, 0, 0]), Matrix: this.obj([1, 0, 0, 1, 0, 0]) }, dict), { Type: 'XObject', Subtype: 'Form' }));\n    };\n    /*\n     * Reference to PDFContentStream that contains a single PDFOperator: `q`.\n     * Used by [[PDFPageLeaf]] instances to ensure that when content streams are\n     * added to a modified PDF, they start in the default, unchanged graphics\n     * state.\n     */\n    PDFContext.prototype.getPushGraphicsStateContentStream = function () {\n        if (this.pushGraphicsStateContentStreamRef) {\n            return this.pushGraphicsStateContentStreamRef;\n        }\n        var dict = this.obj({});\n        var op = PDFOperator.of(Ops.PushGraphicsState);\n        var stream = PDFContentStream.of(dict, [op]);\n        this.pushGraphicsStateContentStreamRef = this.register(stream);\n        return this.pushGraphicsStateContentStreamRef;\n    };\n    /*\n     * Reference to PDFContentStream that contains a single PDFOperator: `Q`.\n     * Used by [[PDFPageLeaf]] instances to ensure that when content streams are\n     * added to a modified PDF, they start in the default, unchanged graphics\n     * state.\n     */\n    PDFContext.prototype.getPopGraphicsStateContentStream = function () {\n        if (this.popGraphicsStateContentStreamRef) {\n            return this.popGraphicsStateContentStreamRef;\n        }\n        var dict = this.obj({});\n        var op = PDFOperator.of(Ops.PopGraphicsState);\n        var stream = PDFContentStream.of(dict, [op]);\n        this.popGraphicsStateContentStreamRef = this.register(stream);\n        return this.popGraphicsStateContentStreamRef;\n    };\n    PDFContext.prototype.addRandomSuffix = function (prefix, suffixLength) {\n        if (suffixLength === void 0) { suffixLength = 4; }\n        return prefix + \"-\" + Math.floor(this.rng.nextInt() * Math.pow(10, suffixLength));\n    };\n    PDFContext.create = function () { return new PDFContext(); };\n    return PDFContext;\n}());\nexport default PDFContext;\n//# sourceMappingURL=PDFContext.js.map"]},"metadata":{},"sourceType":"module"}